<html>
<head>
  <!-- Circles' head scripts [REQUIRED] -->
  <circles-start-scripts/>
</head>
<body>
  <!-- this is used to create our enter UI that creates a 2D overlay to capture a user gesture for sound/mic access etc. -->
  <circles-start-ui/>

  <!-- a-scene with 'circles-properties' component [REQUIRED] -->
  <a-scene circles_scene_properties>
    <a-assets>

      <a-asset-item id="telegraph-gltf" src="assets/telegraph.glb"></a-asset-item>
      <a-asset-item id="IngeniumLab-gltf" src="assets/Ingenium_Lab.glb"></a-asset-item>
      <a-asset-item id="button-gltf" src="assets/Button.glb"></a-asset-item>

      <!-- Source: "Minimal Pop Click UI 8" - https://pixabay.com/sound-effects/minimal-pop-click-ui-8-198308/-->
      <audio id="btnPress_sfx" src="assets/sounds/btnPress_sfx.mp3" preload="auto" crossorigin="anonymous"></audio>

      <!-- Circles' built-in assets [REQUIRED] -->
      <a-asset-item id="navmesh_gltf" src="assets/Ingenium_Lab_NavMesh.glb" response-type="arraybuffer" crossorigin="anonymous"></a-asset-item>
      <circles-assets/>
    </a-assets>

    <!-- Circles' built-in manager and avatar [REQUIRED] -->
    <circles-manager-avatar/>

    <a-entity id = "lab" gltf-model="#IngeniumLab-gltf" position="0 0 0" scale="1 1 1" rotation="0 0 0">
      <a-entity id="navmesh" gltf-model="#navmesh_gltf" visible='false' nav-mesh></a-entity>

      <a-entity light="type: ambient; intensity: 3"></a-entity>
      <a-entity light="intensity: 3; castShadow: true; decay: 0.3; type: spot; color: #dcf6fe" position="-0.43992 12.10078 1.34728" rotation="-82.92131690030838 0 179.9998479605043" scale=""></a-entity>
      <a-entity light="intensity: 3; castShadow: true; type: spot; decay: 0.3; color: #dcf6fe" position="-0.1674 -7.53666 0" rotation="90 0 0" scale=""></a-entity>
      
    <!-- LIGHTS SECTION 1-->
    <a-entity rotation="0 90 0" position="-1.5 1.5 0.8">
      <!-- ROW 1 -->
      <a-entity geometry="primitive: cylinder" position="3.5 3.767 -1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="3.5 3.635 -1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
      <!-- ROW 2 -->
      <a-entity geometry="primitive: cylinder" position="2 3.767 1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="2 3.635 1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>

      <a-entity geometry="primitive: cylinder" position="5 3.767 1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="5 3.635 1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
      <!-- ROW 3 -->
      <a-entity geometry="primitive: cylinder" position="3.5 3.767 4.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="3.5 3.635 4.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
    </a-entity>

    <!-- LIGHTS SECTION 2-->
    <a-entity rotation="0 90 0" position="-1.5 1.5 6.25">
      <!-- ROW 1 -->
      <a-entity geometry="primitive: cylinder" position="2 3.767 -1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="2 3.635 -1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>

      <a-entity geometry="primitive: cylinder" position="5 3.767 -1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="5 3.635 -1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
      <!-- ROW 2 -->
      <a-entity geometry="primitive: cylinder" position="3.5 3.767 1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="3.5 3.635 1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
      <!-- ROW 3 -->
      <a-entity geometry="primitive: cylinder" position="2 3.767 4.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="2 3.635 4.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>

      <a-entity geometry="primitive: cylinder" position="5 3.767 4.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="5 3.635 4.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
    </a-entity>

    <!-- LIGHTS SECTION 3 -->
    <a-entity rotation="0 90 0" position="-1.5 1.5 -5">
      <!-- ROW 1 -->
      <a-entity geometry="primitive: cylinder" position="2 3.767 -1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="2 3.635 -1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>    

      <a-entity geometry="primitive: cylinder" position="5 3.767 -1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="5 3.635 -1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
      <!-- ROW 2 -->
      <a-entity geometry="primitive: cylinder" position="3.5 3.767 1.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="3.5 3.635 1.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
      <!-- ROW 3 -->
      <a-entity geometry="primitive: cylinder" position="2 3.767 4.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="2 3.635 4.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>

      <a-entity geometry="primitive: cylinder" position="5 3.767 4.5" rotation="" scale="0.125 0.25 0.125" material="color: #454545"></a-entity>
      <a-entity geometry="primitive: circle" position="5 3.635 4.5" rotation="90 90 0" scale="0.1 0.1 0.1" material="color: #ffd500; emissive: #ffffff; emissiveIntensity: 100"></a-entity>
    </a-entity>

    <a-entity id="currentArtefactTxt" position="-4.712 1.855 -2.448" rotation="0 90 0" text="width: 4; value:Currently Targeted Artefact:\n\n Telegraph; align: center; color: white"></a-entity>

    <a-entity position="-4.22795 0.927 -2.448" geometry="depth: 1.2; height: 0.07; width: 0.5" material="color: #363636">
      <a-entity position="0 -0.01662 0.42">
        <a-entity id="btnTelgraph" gltf-model="#button-gltf" class="interactive" scale="" circles-material-extend-fresnel="fresnelOpacity: 0; fresnelPow: 2" sound="volume: 0.5" circles-interactive-object="type: scale; click_sound:#btnPress_sfx" animation__highlightanim="property: scale; to: 1 1 1; dur: 100"></a-entity>
        <a-entity position="-0.15237 0.27372 0" rotation="0 90 0" text="width: 2; value: Telegraph; align: center; color: white" circles-lookat="constrainYAxis:false"></a-entity>
      </a-entity>

      <a-entity position="0 -0.01662 0" >
        <a-entity id="btnRotary" gltf-model="#button-gltf" class="interactive" scale="" circles-material-extend-fresnel="fresnelOpacity: 0; fresnelPow: 2" sound="volume: 0.5" circles-interactive-object="type: scale; click_sound:#btnPress_sfx" animation__highlightanim="property: scale; to: 1 1 1; dur: 100"></a-entity>
        <a-entity position="-0.15237 0.27372 0" rotation="0 90 0" text="width: 2; value: Rotary\n Phone; align: center; color: white" circles-lookat="constrainYAxis: false;"></a-entity>
      </a-entity>

      <a-entity position="0 -0.01662 -0.42">
        <a-entity id="btnCell" gltf-model="#button-gltf" class="interactive" scale="" circles-material-extend-fresnel="fresnelOpacity: 0; fresnelPow: 2" sound="volume: 0.5" circles-interactive-object="type: scale; click_sound:#btnPress_sfx" animation__highlightanim="property: scale; to: 1 1 1; dur: 100"></a-entity>
        <a-entity position="-0.15237 0.27372 0" rotation="0 90 0" text="width: 2; value: Cell\n Phone; align: center; color: white" circles-lookat="constrainYAxis:false"></a-entity>
      </a-entity>
    </a-entity>

    <a-entity id="telegraph"
    position="3.09577 -20.98801 -4.08334" rotation="0 -61.790633415883626 0" scale="2.719 2.719 2.719"
    gltf-model="assets/telegraph.glb" 
    shadow="receive:false; cast:false;"
    circles-artefact="inspectScale:8 8 8; inspectRotation:0 0 0; inspectPosition:0 0 0;
                      origScale:2.719 2.719 2.719; origRotation:0 0 0;
                      label_offset:0 0.5 0; arrow_position:down;
                      textRotationY:270;
                      title:The Telegraph - 1844; 
                      description:The Telegraph is used to send messages over long distances, using wires that carries electrical signals. These signals are encoded and decoded in a specialized cipher called Morse Code;
                      description_on: true;
                      label_text:The Telegraph;
                      label_on: true;"></a-entity>

      <a-entity id="TimeTraveler-Group"
                  position="-4.31 1.18 -0.222" rotation="0 0 0"
                  material="side:back;"
                  circles-portal="img_src:assets/TTime_Telegraph_Preview.png; title_text:Time Traveler Group; link_url:/w/TTime_Telegraph?group=timeTraveler&hub_state=000"
                  shadow></a-entity>

      <a-entity id="MissionControl-Group"
                  position="-4.31 1.18 -4.75" rotation="0 0 0"
                  circles-portal="img_src:assets/MissionControlRoom_Preview.png; title_text:Mission Control Group; link_url:/w/TTime_MissionControl?group=missionControl&artefact=rotary&hub_state=000"
                  shadow></a-entity>

      <a-entity circles-checkpoint position="1.860 0.05 -2.580"></a-entity>
      <a-entity circles-checkpoint circles-spawnpoint position="0.610 0.05 -8.228"></a-entity>
      <a-entity circles-checkpoint position="-2.896 0.05 -4.730"></a-entity>
      <a-entity circles-checkpoint position="-2.6 0.05 -2.448"></a-entity>
      <a-entity circles-checkpoint position="-2.896 0.05 -0.208"></a-entity>
      <a-entity circles-checkpoint circles-spawnpoint position="-0.148 0.05 4.963"></a-entity>
      <a-entity circles-checkpoint circles-spawnpoint position="-0.455 0.05 -1.794"></a-entity>
    </a-entity>
  </a-scene>

  <!-- Circles' end scripts [REQUIRED] -->
  <circles-end-scripts/>
 </body>
 <script src="js/level-selector.js"></script>
 <script>
  let hubStateStr = "000";

  let hrefData = new URLSearchParams(location.search);
  let hubState = hrefData.get('hub_state');

  console.log(hubState);
  if (hubState == null) {
    console.log("NULL");
  }
  else {
    hubStateStr = hubState;

    hubState = parseInt(hubState);
    if (hubState % 10 == 1) {
      console.log('load telegraph artefact');
      document.querySelector('#telegraph').setAttribute('position', {x:3.09577, y:0.98801, z:-4.08334});
    }
    if (Math.floor((hubState % 100) / 10) == 1) {
      console.log('load rotary artefact');
    }
    if (Math.floor(hubState / 100) == 1) {
      console.log('load cell artefact');
    }
  }

  document.querySelector('#TimeTraveler-Group').setAttribute('circles-portal', {link_url: "/w/TTime_Telegraph?group=timeTraveler&hub_state=" + hubStateStr});
  document.querySelector('#MissionControl-Group').setAttribute('circles-portal', {link_url: "/w/TTime_MissionControl?group=timeTraveler&artefact=telegraph&hub_state=" + hubStateStr});
 </script>
</html>